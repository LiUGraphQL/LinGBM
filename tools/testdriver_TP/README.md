# Test Driver <br/> of the Link√∂ping GraphQL Benchmark (LinGBM)

This directory contains the test driver program of the benchmark, which is developed based on a [basic version of the test-driver](https://github.com/LiUGraphQL/evaluation-graphql-server-techniques/tree/master/test-driver). More specifically, this program could test the throughput of each query template within a given time interval.

The required input for the test driver is the path to the actual queries directory generated by the querygen tool. 


### Setup
Before starting the test driver, you have to first start up the GraphQL server, and generate the queries with the [querygen](https://github.com/LiUGraphQL/LinGBM/tree/master/tools/querygen).
Then, you could build up the test driver using the following command:

```
git clone git@github.com:LiUGraphQL/LinGBM.git
cd LinGBM/tools/testdriver_TP/
npm install
yarn run build
```

### Usage

To capture the throughput of each query template, please use the following example command:
```
yarn start -a ACTUALQUERIES_PATH
```
The ACTUALQUERIES_PATH needs to be the path where the generated queries are. This tool will then synchronously load all the generated queries and run them one by one. By default, this tool captures the throughput of each query templates and writes the throughput of all query templates into a separate file "xxx_statistics" under the directory `./output/`. The statistics values contain the number of "total send out query", "successfully executed query", "error query" within the given time period.

If you need to capture the throughput of only one specific query template, then the option '-q <queryTP>' can be used for setting the query template. For example, the following command is for capturing the throughput of query template 1
```
yarn start -a ACTUALQUERIES_PATH -q 1
```

In addition, there are also some other arguments can be used to change the configuration of the test driver:
| Argument | Description |
| ------ | ------|
|-a, --actual-queries \<path>|Path to actualQueries folder| 
|-c, --clients \<clients> |Number of clients. Default: 1| 
|-s --server <url> |URL to the GraphQL server to test. Default: localhost |
|-p --port <port> |Port used by the GraphQL server. Default: "4000"|
|-u --urlSuffix <urlSuf> |URL suffix used by the GraphQL server. Default: ""|
|-t --type <type> |Type of test to run, tp (throughput). tp |
|-i --interval <interval> |How long the test should run for. Default: 30 sec|
|-o --name <name> |Set the name of the output file |
|-q, --queryTP <queryTP> |Set the queryTemplate to test|
|-n, --repeatNr <repeatNr> |Set the number of running the test, 1 refers to the first time. Default: 1|
|-r, --repeat <repeat> |Set the number of times to repeat the test. Default: 1|

